<!DOCTYPE html>
<html lang="en">
<head>
    <title>Confirm the Gym and date | 1GymApp</title>
</head>
<body>
    <header>
        <nav>
            <ul>
                <li><button class="indexButton" onclick="location.href='index.html'">Home</button></li>
            </ul>
        </nav>
    </header>
    <main>
        <aside id="gyminfo">Insert gym info here</aside>
        <article>
            <form name="formConfirm" id="formConfirm" action="" onsubmit="">
                <div class="div-confirm">
                    <div><label for="date">Select date</label></div>
                    <div><input type="date" name="date" id= "date" onchange="validateDate(document.formConfirm.date.value)"/></div>
                    <div><label for="price">Price</label></div>
                    <div><input type="text" id="price" readonly></label></div>
                </div>
                <div>
                    <div><label for="quantity">Select quantity</label></div>
                    <select name="quantity" id="quantity">
                        <option value="1">1</option>
                        <option value="3">3</option>
                        <option value="5">5</option>
                        <option value="10">10</option>
                    </select>
                </div>
            </form>
        </article>
        <div id="paypal-button-container"></div>
    </main>
    <footer>
        <p id="copyright">Copyright &copy; of JP Inc </p>
    </footer>
    <script src="https://www.gstatic.com/firebasejs/8.6.1/firebase.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.1/firebase-analytics.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
    <script src="javaScript/server.js"></script>
    <script src="javaScript/confirm.js"></script>
    <script src="https://www.paypal.com/sdk/js?client-id=Aeh5DFX4OTtt1nigq-axrjq9cWKviTcey0z_3hFhoElBwmpAABGhndOnkfvfuRmeO7Xp1c4VyE10TJSe&currency=EUR"></script>
    <script>
        paypal.Buttons({
          // Sets up the transaction when a payment button is clicked
          createOrder: (data, actions) => 
          {
            return actions.order.create({
              purchase_units: [{
                amount: {
                  value: document.getElementById("price").value
                }
              }]
            });
          },
          
          onClick: (e) =>
          {
            var capacity = sessionStorage.getItem('capacity');
           
            if (capacity <= document.getElementById('quantity').value)
            {
                event.preventDefault();
            }
            //TODO validation here for date field & capacity
          },

          // Finalize the transaction after payer approval
          onApprove: (data, actions) => 
          {
            return actions.order.capture().then(function(orderData) 
            {
              // Successful capture! For dev/demo purposes:
              console.log('Capture result', orderData, JSON.stringify(orderData, null, 2));
              const transaction = orderData.purchase_units[0].payments.captures[0];
              alert(`Transaction ${transaction.status}: ${transaction.id}\n\nSee console for all available details`);
              // When ready to go live, remove the alert and show a success message within this page. For example:
              // const element = document.getElementById('paypal-button-container');
              // element.innerHTML = '<h3>Thank you for your payment!</h3>';
              // Or go to another URL:  actions.redirect('thank_you.html');
              linkUserToGym();
              //TODO reduce capacity
            });
          }
        }).render('#paypal-button-container');
      </script>
</body>
</html>

